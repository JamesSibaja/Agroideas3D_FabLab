<!-- se extiende la plantilla genérica-->
{% extends "generica.html" %}
{% block content %}  

<style>

.info-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #fff;
    border-top: 1px solid #ccc;
    padding: 20px;
    display: none; /* Oculta el panel por defecto */
}


.product-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin: 20px;
    position: relative;
    /* float: left; */
}
/* .container {
    box-sizing: border-box;  
    overflow: auto;
} */

.product-list.active {
  width: 60%;
}

.product {
    position: relative;
    border-radius: 8px;
    width: 28%;
    min-width: 300px; /* Ancho mínimo para el contenedor */
    height: 320px;
    /* text-align: center; */
    /* padding: 2px; */
    margin: 1%;
}

.view-button, .download-button-2 {
    position: absolute;
    top: 0;
    width: 50%;
    height: 200px;
    color: white;
    border: none;
    opacity: 0;
    transition: opacity 0.2s;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.5);
    
}

.view-button:hover, .download-button-2:hover {
    /* background-color: rgba(0, 0, 0, 0.75); */
    background-color: #47129ba8;
}

.view-button {
    left: 0;
    border-radius: 8px 0 0 8px;
}
.download-button-2 {
    right: 0;
    border-radius: 0 8px 8px 0;
}

/* .product:hover .view-button {
    display: block; 
    
} */

.product-dowload {
    display: none; /* Inicialmente oculta el botón */
    position: absolute; /* Posiciona el botón en relación al producto */
    top: 55px; /* Ajusta la posición vertical del botón */
    left: 50%; /* Ajusta la posición horizontal del botón */
    transform: translateX(-50%); 
    color: #ffffff;
    
}

.product:hover .product-dowload {
    display: block;
}


.product-image {
    
    width: 100%;
    height: 200px;
    object-fit: cover;
    box-shadow: 0 4px 6px rgba(61, 61, 61, 0.473);
    border: 1px solid #383838; 
    /* height: auto; */
    /* object-fit: cover; */
    /* filter: brightness(105%);  */
    border-radius: 8px;
    transition: transform 0.3s ease;
}



.product-name {
    font-size: 1.2rem;
    font-weight: bold;
}



.product-description {
    /* font-size: 1rem; */
    margin: 10px 0;
    color: #555;
    overflow-y: hidden;
    max-height: 140px; /* Altura máxima del contenedor */
}
.button:hover {
    background-color: #5715c0;
    transform: scale(1.1);
    filter: brightness(1.2);
}

#search_input {
    display: flex;
    width: 100%;
}

.search-box {
    width: 100%;
    display: flex;
}
.product:hover .view-button, .product:hover .download-button-2 {
    opacity: 1;
    /* transform: scale(1.05); */
}
.search-box input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px 0 0 5px;
    height: 40px;
}

.search-box button {
    background-color: #949494;
    color: #ffffff;
    border: none;
    padding: 8px;
    border-radius: 0 5px 5px 0;

    height: 40px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.search-box button:hover {
    background-color: #0056b3;
}
.text-option{
    display: block;
}
.div-image-view {
    display: none;
    width: 37%;
    position: relative;
    z-index: 1000;
    padding: 20px;
    /* overflow-y: auto; */
    height: 100%; /* Asegura que cubre todo el alto de su contenedor */

}


.image-view {
    position: -webkit-sticky; /* For Safari */
    position: sticky;
    top: 70px; /* Sticky a partir de 20px desde la parte superior */
    width: 100%;
    background-color: white;
    border-radius: 10px;
    box-shadow: -2px 0 5px rgba(0,0,0,0.3);
    padding: 20px;
    box-sizing: border-box;
    height: 700px;
    overflow-y: scroll;
}
.div-image-view.active {
    display: block;
}
.image-view img {
    width: 100%;
    height: auto;
    margin-bottom: 20px;
}
.close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
}
@media (max-width: 768px) {
    .info-panel {
        display: block;
    }
    .product {
        width: 90%;
    }
    .view-button, .download-button-2{
        left: auto;
        right: 0;
        border: 1px solid #383838; 
        width: 30%;
        height: 100px;
        opacity: 1;
    }
    .view-button{
        top: 0px;
        background-color: #3b209b;
        border-radius: 0 8px 0 0 ; 
    }
    .view-button:hover{
        background-color: #3b209b;
        filter: brightness(0.85);
    }
     .download-button-2:hover {
        /* background-color: #29166b; */
        background-color: #1d50be ;
        filter: brightness(0.95);
        
    }
    
    .product-image{
        position: relative;
        width: 70%;
        left: 0%;
        border-radius: 8px 0 0 8px;
        box-shadow: 0 0 0;
    }
    .material-icons{
        font-size: 40px;
    }
    .download-button-2{
        top: 100px;
        background-color: #1d50be ;
        
        border-radius: 0 0 8px 0 ;
    }
    .text-option{
        display: none;
    }
}
</style>
<!-- <script>
  // Definimos una variable llamada 'miVariable' y le asignamos un valor
  val1 = 2;

</script> -->
<div class="container" style="background-color:rgba(255, 255, 255, 0);min-height: 100%;height: auto;" >

  <div class="separar"></div>  
    <!-- <h1 style="margin-top: 15px;margin-bottom: 15px;text-align: center;">Catálogo</h1> -->
    <div style="margin-top: 30px;" id="search_input">
      <form method="get" class="search-box">  
          <input type="text" class="form-control" placeholder="Buscar..." name="buscar" value="{{request.GET.buscar}}">
          <!-- <input type="hidden" name="ver" value="true"> -->
          <button class="btn btn-primary js-tooltip" type="submit">
              <i class="material-icons">search</i>
          </button>
      </form>
    </div>


    
    {%load static%} 
    <div class="info-panel">
      <!-- Contenido del panel de información -->
      <h1 style="margin-top: 15px;margin-bottom: 15px;text-align: center;">Catálogo</h1> 
  </div>    
    
<div style="float: left; width: 100%;margin-top: 25px;  text-align: center;margin-bottom: 20px;">
      
    </div>

    
    <div class="pagination" style="width: 100%; justify-content: center;">
      <span class="step-links" >
          {% if catalogo.has_previous %}
              <a href="?page=1">&laquo; Primera</a>
              <a href="?page={{ catalogo.previous_page_number }}">anterior</a>
          {% endif %}
    
          <span class="current">
              Página {{ catalogo.number }} de {{ catalogo.paginator.num_pages }}.
          </span>
    
          {% if catalogo.has_next %}
              <a href="?page={{ catalogo.next_page_number }}">siguiente</a>
              <a href="?page={{ catalogo.paginator.num_pages }}">Última &raquo;</a>
          {% endif %}
      </span>
    </div>  
    <div style="display: flex; flex-direction: row;">
      <div class="product-list">
        {%load static%} 
    {%for slide in catalogo%}
    <div class="product" data-id="{{ slide.id }}">
        <img src="{{ slide.imagen.url }}" alt="{{ slide.nombre }}" class="product-image">
        <!-- <button onclick="location.href='{% url 'Mapa' %}'" class="view-button btn btn-outline-primary js-tooltip">
            <i  style="margin-right: 3px;" class="material-icons">visibility</i> <span class="text-option">Ver</span>
        </button> -->
        <button class="view-button btn btn-outline-primary js-tooltip">
            <i style="margin-right: 3px;" class="material-icons">visibility</i> <span class="text-option">Ver</span>
        </button>
        <a href="{{ slide.path.url }}" download="{{ slide.nombre }}.stl" class="download-button-2 btn btn-outline-primary js-tooltip">
            <i style="margin-right: 6px;padding-bottom: 5px;" class="material-icons">cloud_download</i> <spam class="text-option">Descargar</spam>
        </a>
        <div class="product-description">
            <h2 class="product-name">{{ slide.nombre }}</h2>
            <p style="font-size: 1rem">{{ slide.descripcion_corta }}</p>
        </div>
    </div>
     
    {%endfor%}
      </div>
      <div class="div-image-view">
        <div class="image-view">
            <button class="close-button">&times;</button>
            <img src="" alt="Vista previa" id="image-view-img">
            <h2 id="image-view-title"></h2>
            <p id="image-view-description"></p>
        </div>

    </div>
</div> 
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const products = document.querySelectorAll('.product');
        const imageView = document.querySelector('.div-image-view');
        const imageViewImg = document.getElementById('image-view-img');
        const imageViewTitle = document.getElementById('image-view-title');
        const imageViewDescription = document.getElementById('image-view-description');
        const closeButton = document.querySelector('.close-button');
        const catalogo = document.querySelector('.product-list');

        products.forEach(product => {
            product.querySelector('.view-button').addEventListener('click', function () {
                const productId = product.getAttribute('data-id');
                
                fetch(`/modelo/${productId}/`)
                    .then(response => response.json())
                    .then(data => {
                        imageViewImg.src = data.imagen;
                        imageViewTitle.textContent = data.nombre;
                        imageViewDescription.textContent = data.descripcion;

                        imageView.classList.add('active');
                        catalogo.classList.add('active');
                        imageView.style.height = catalogo.offsetHeight + 'px';
                    });
            });
        });

        closeButton.addEventListener('click', function () {
            imageView.classList.remove('active');
            catalogo.classList.remove('active');
        });
        function iniciarReconocimiento() {
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                // Usa la API de Web Speech si está disponible
                iniciarReconocimientoVoz();
            } else {
                // Alternativa para navegadores que no soportan Web Speech
                iniciarGrabacionAlternativa();
            }
        }

    });
</script>

{% endblock %}
